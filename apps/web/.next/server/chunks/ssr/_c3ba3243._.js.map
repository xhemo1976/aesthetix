{"version":3,"sources":["../../../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../../node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.5_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../../apps/web/lib/supabase/admin.ts","../../../../../../apps/web/lib/actions/tenant-domain.ts","../../../../../../apps/web/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","import { createClient } from '@supabase/supabase-js'\nimport type { Database } from '@/lib/types/database'\n\nexport function createAdminClient() {\n  return createClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false\n      }\n    }\n  )\n}\n","'use server'\n\nimport { createAdminClient } from '@/lib/supabase/admin'\n\n// Mapping von Subdomain zu Tenant-Slug\n// Sp√§ter kann das in der Datenbank gespeichert werden\nconst SUBDOMAIN_MAPPING: Record<string, string> = {\n  'demo': 'demo-klinik', // demo.esylana.de -> demo-klinik tenant\n  'gastro': 'demo-gastro', // gastro.esylana.de -> demo-gastro tenant\n}\n\ninterface Tenant {\n  id: string\n  name: string\n  slug: string\n  logo_url: string | null\n  business_type: string | null\n  whatsapp_number: string | null\n}\n\nexport async function getTenantBySubdomain(subdomain: string): Promise<{ tenant: Tenant | null; error: string | null }> {\n  try {\n    const adminClient = createAdminClient()\n\n    // Erst im Mapping schauen\n    const mappedSlug = SUBDOMAIN_MAPPING[subdomain]\n\n    if (mappedSlug) {\n      // Suche Tenant der mit diesem Slug beginnt\n      const { data: tenant, error } = await adminClient\n        .from('tenants')\n        .select('*')\n        .ilike('slug', `${mappedSlug}%`)\n        .limit(1)\n        .single()\n\n      if (error || !tenant) {\n        return { tenant: null, error: 'Tenant nicht gefunden' }\n      }\n\n      return { tenant, error: null }\n    }\n\n    // Sonst direkt nach Subdomain als Slug suchen\n    const { data: tenant, error } = await adminClient\n      .from('tenants')\n      .select('*')\n      .ilike('slug', `${subdomain}%`)\n      .limit(1)\n      .single()\n\n    if (error || !tenant) {\n      return { tenant: null, error: 'Tenant nicht gefunden' }\n    }\n\n    return { tenant, error: null }\n  } catch (error) {\n    console.error('Error getting tenant by subdomain:', error)\n    return { tenant: null, error: 'Fehler beim Laden' }\n  }\n}\n\ninterface Service {\n  id: string\n  name: string\n  description: string | null\n  duration_minutes: number\n  price: number\n  category: string | null\n  image_url: string | null\n  allergens: string[] | null\n  is_vegetarian: boolean\n  is_vegan: boolean\n  is_spicy: boolean\n}\n\ninterface Employee {\n  id: string\n  name: string\n  role: string | null\n  avatar_url: string | null\n  profile_image_url: string | null\n  bio: string | null\n}\n\ninterface Location {\n  id: string\n  name: string\n  address: string | null\n  city: string | null\n  phone: string | null\n}\n\nexport async function getTenantWithDetails(tenantId: string): Promise<{\n  services: Service[]\n  employees: Employee[]\n  locations: Location[]\n  error: string | null\n}> {\n  try {\n    const adminClient = createAdminClient()\n\n    const [\n      { data: services },\n      { data: employeesRaw },\n      { data: locations }\n    ] = await Promise.all([\n      adminClient\n        .from('services')\n        .select('*')\n        .eq('tenant_id', tenantId)\n        .eq('is_active', true)\n        .order('name'),\n      adminClient\n        .from('employees')\n        .select('id, first_name, last_name, role, profile_image_url, bio')\n        .eq('tenant_id', tenantId)\n        .eq('is_active', true)\n        .order('first_name'),\n      adminClient\n        .from('locations')\n        .select('*')\n        .eq('tenant_id', tenantId)\n        .order('is_primary', { ascending: false })\n    ])\n\n    // Transform employees to include 'name' field\n    const employees = (employeesRaw || []).map((emp: { id: string; first_name: string; last_name: string; role: string | null; profile_image_url: string | null; bio: string | null }) => ({\n      id: emp.id,\n      name: `${emp.first_name} ${emp.last_name}`,\n      role: emp.role,\n      avatar_url: null,\n      profile_image_url: emp.profile_image_url,\n      bio: emp.bio,\n    }))\n\n    return {\n      services: services || [],\n      employees,\n      locations: locations || [],\n      error: null\n    }\n  } catch (error) {\n    console.error('Error getting tenant details:', error)\n    return { services: [], employees: [], locations: [], error: 'Fehler beim Laden' }\n  }\n}\n","export {getTenantWithDetails as '4057a6388d4198228c22a0a5a5a2c124420a6c092a'} from 'ACTIONS_MODULE0'\nexport {getTenantBySubdomain as '40a94da28fa7230192875b8f0bef9c317fa2042f09'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}