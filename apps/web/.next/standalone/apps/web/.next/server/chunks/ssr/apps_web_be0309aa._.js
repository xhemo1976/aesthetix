module.exports=[66076,a=>{"use strict";var b=a.i(38735),c=a.i(80159),d=a.i(81182),e=a.i(56511);async function f(){let a=await (0,c.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return{locations:[],error:"Nicht authentifiziert"};let{data:d}=await a.from("users").select("tenant_id").eq("id",b.id).single();if(!d?.tenant_id)return{locations:[],error:"Kein Tenant gefunden"};let{data:e,error:f}=await a.from("locations").select("*").eq("tenant_id",d.tenant_id).order("is_primary",{ascending:!1}).order("name",{ascending:!0});if(f)return{locations:[],error:f.message};let g=[];for(let b of e||[]){let{count:c}=await a.from("employee_locations").select("*",{count:"exact",head:!0}).eq("location_id",b.id),{count:d}=await a.from("services").select("*",{count:"exact",head:!0}).eq("location_id",b.id).eq("is_active",!0);g.push({...b,employee_count:c||0,service_count:d||0})}return{locations:g,error:null}}async function g(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("locations").select("*").eq("id",a).single();return e?{location:null,error:e.message}:{location:d,error:null}}async function h(a){let b=await (0,c.createClient)(),{data:{user:d}}=await b.auth.getUser();if(!d)return{location:null,error:"Nicht authentifiziert"};let{data:f}=await b.from("users").select("tenant_id, role").eq("id",d.id).single();if(!f?.tenant_id)return{location:null,error:"Kein Tenant gefunden"};if(!["owner","admin"].includes(f.role))return{location:null,error:"Keine Berechtigung"};let g=a.get("name"),h=a.get("slug"),i=a.get("address"),j=a.get("city"),k=a.get("postal_code"),l=a.get("phone"),m=a.get("email"),n=a.get("whatsapp_number");if(!g||!h)return{location:null,error:"Name und Slug sind erforderlich"};let{data:o}=await b.from("locations").select("id").eq("tenant_id",f.tenant_id).eq("slug",h).single();if(o)return{location:null,error:"Dieser Slug wird bereits verwendet"};let p={tenant_id:f.tenant_id,name:g,slug:h.toLowerCase().replace(/[^a-z0-9-]/g,"-"),address:i||null,city:j||null,postal_code:k||null,phone:l||null,email:m||null,whatsapp_number:n||null,is_active:!0,is_primary:!1},{data:q,error:r}=await b.from("locations").insert(p).select().single();return r?{location:null,error:r.message}:((0,e.revalidatePath)("/dashboard/locations"),{location:q,error:null})}async function i(a,b){let d=await (0,c.createClient)(),f=b.get("name"),g=b.get("address"),h=b.get("city"),i=b.get("postal_code"),j=b.get("phone"),k=b.get("email"),l=b.get("whatsapp_number"),m="true"===b.get("is_active"),{data:n,error:o}=await d.from("locations").update({name:f,address:g||null,city:h||null,postal_code:i||null,phone:j||null,email:k||null,whatsapp_number:l||null,is_active:m}).eq("id",a).select().single();return o?{location:null,error:o.message}:((0,e.revalidatePath)("/dashboard/locations"),{location:n,error:null})}async function j(a){let b=await (0,c.createClient)(),{data:d}=await b.from("locations").select("is_primary").eq("id",a).single();if(d?.is_primary)return{success:!1,error:"Der Hauptstandort kann nicht gelÃ¶scht werden"};let{error:f}=await b.from("locations").delete().eq("id",a);return f?{success:!1,error:f.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function k(a){let b=await (0,c.createClient)(),{data:{user:d}}=await b.auth.getUser();if(!d)return{success:!1,error:"Nicht authentifiziert"};let{data:f}=await b.from("users").select("tenant_id").eq("id",d.id).single();if(!f?.tenant_id)return{success:!1,error:"Kein Tenant gefunden"};await b.from("locations").update({is_primary:!1}).eq("tenant_id",f.tenant_id);let{error:g}=await b.from("locations").update({is_primary:!0}).eq("id",a);return g?{success:!1,error:g.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function l(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("employee_locations").select(`
      employees (
        id,
        first_name,
        last_name,
        role
      )
    `).eq("location_id",a);return e?{employees:[],error:e.message}:{employees:(d||[]).map(a=>Array.isArray(a.employees)?a.employees[0]:a.employees).filter(Boolean),error:null}}async function m(a,b){let d=await (0,c.createClient)(),{error:f}=await d.from("employee_locations").insert({employee_id:a,location_id:b});return f?"23505"===f.code?{success:!1,error:"Mitarbeiter ist bereits diesem Standort zugewiesen"}:{success:!1,error:f.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function n(a,b){let d=await (0,c.createClient)(),{error:f}=await d.from("employee_locations").delete().eq("employee_id",a).eq("location_id",b);return f?{success:!1,error:f.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function o(a){let b=(0,d.createAdminClient)(),{data:c}=await b.from("tenants").select("id").eq("slug",a).single();if(!c)return{locations:[],error:"Tenant nicht gefunden"};let{data:e,error:f}=await b.from("locations").select("*").eq("tenant_id",c.id).eq("is_active",!0).order("is_primary",{ascending:!1}).order("name",{ascending:!0});return f?{locations:[],error:f.message}:{locations:e||[],error:null}}async function p(a,b){let c=(0,d.createAdminClient)(),{data:e}=await c.from("tenants").select("id").eq("slug",a).single();if(!e)return{location:null,error:"Tenant nicht gefunden"};let{data:f,error:g}=await c.from("locations").select("*").eq("tenant_id",e.id).eq("slug",b).eq("is_active",!0).single();return g?{location:null,error:g.message}:{location:f,error:null}}(0,a.i(98246).ensureServerEntryExports)([f,g,h,i,j,k,l,m,n,o,p]),(0,b.registerServerReference)(f,"0055b89c801663552805ddc909292e775db7be216e",null),(0,b.registerServerReference)(g,"4037ff8b431861586ad97cd1e90717ce84f298b15d",null),(0,b.registerServerReference)(h,"40f54ec9e5477630fdb316dff0ae467e31697718f6",null),(0,b.registerServerReference)(i,"604a24bf2e6a49d259d29523655d0f76667aa253b3",null),(0,b.registerServerReference)(j,"40b78c56213e2c793df5b07094b681c8a692b2184b",null),(0,b.registerServerReference)(k,"40a0a4208153142c8e89a3bfcc14e6935d23ca1e9e",null),(0,b.registerServerReference)(l,"40b1e54b6f607f754e725a9dd43ea09889f3684f34",null),(0,b.registerServerReference)(m,"60297aeec1b44af1ea5303b7ea622c2305a16198cc",null),(0,b.registerServerReference)(n,"6021891db63625de842e1acd9ce600c58b0dcf65af",null),(0,b.registerServerReference)(o,"4095af700589660c59d792e54e467cf5e6cb9ca856",null),(0,b.registerServerReference)(p,"60a9690d48ecf36d6cc007c00e1aa0f1880037f3a1",null),a.s(["assignEmployeeToLocation",()=>m,"createLocation",()=>h,"deleteLocation",()=>j,"getLocationById",()=>g,"getLocationEmployees",()=>l,"getLocations",()=>f,"getPublicLocationBySlug",()=>p,"getPublicLocations",()=>o,"removeEmployeeFromLocation",()=>n,"setLocationAsPrimary",()=>k,"updateLocation",()=>i])},6617,a=>{"use strict";var b=a.i(76392),c=a.i(66076);a.s([],85745),a.i(85745),a.s(["0055b89c801663552805ddc909292e775db7be216e",()=>c.getLocations,"00ea5d6db9aa78d155ad7148c00d987a78197cad0e",()=>b.logout,"4037ff8b431861586ad97cd1e90717ce84f298b15d",()=>c.getLocationById,"40557600bffd5a2c9eccc9fb8b66b41ea0de68fa87",()=>b.login,"4095af700589660c59d792e54e467cf5e6cb9ca856",()=>c.getPublicLocations,"40a0a4208153142c8e89a3bfcc14e6935d23ca1e9e",()=>c.setLocationAsPrimary,"40b1e54b6f607f754e725a9dd43ea09889f3684f34",()=>c.getLocationEmployees,"40b78c56213e2c793df5b07094b681c8a692b2184b",()=>c.deleteLocation,"40edf544285d63aedbf98dd3fd472b99b616040b0a",()=>b.signup,"40f54ec9e5477630fdb316dff0ae467e31697718f6",()=>c.createLocation,"6021891db63625de842e1acd9ce600c58b0dcf65af",()=>c.removeEmployeeFromLocation,"60297aeec1b44af1ea5303b7ea622c2305a16198cc",()=>c.assignEmployeeToLocation,"604a24bf2e6a49d259d29523655d0f76667aa253b3",()=>c.updateLocation,"60a9690d48ecf36d6cc007c00e1aa0f1880037f3a1",()=>c.getPublicLocationBySlug],6617)}];

//# sourceMappingURL=apps_web_be0309aa._.js.map