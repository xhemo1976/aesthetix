module.exports=[61210,a=>{"use strict";var b=a.i(38735),c=a.i(80159);function d(a){let b=new Date,c=new Date(b);c.setHours(23,59,59,999);let d=new Date(b);switch(d.setHours(0,0,0,0),a){case"today":break;case"week":d.setDate(d.getDate()-7);break;case"month":d.setMonth(d.getMonth()-1);break;case"year":d.setFullYear(d.getFullYear()-1)}return{start:d,end:c}}async function e(a="month"){let b=await (0,c.createClient)(),{data:{user:f}}=await b.auth.getUser();if(!f)return{stats:null,error:"Nicht authentifiziert"};let{data:g}=await b.from("users").select("tenant_id").eq("id",f.id).single();if(!g?.tenant_id)return{stats:null,error:"Kein Tenant gefunden"};let{start:h,end:i}=d(a),{data:j,error:k}=await b.from("appointments").select("id, status, price, total_paid").eq("tenant_id",g.tenant_id).gte("start_time",h.toISOString()).lte("start_time",i.toISOString());if(k)return{stats:null,error:k.message};let l={total:0,completed:0,pending:0,canceled:0,appointmentCount:j?.length||0,completedCount:0,canceledCount:0,noShowCount:0};for(let a of j||[]){let b=a.price||0;switch(a.status){case"completed":l.completed+=b,l.total+=b,l.completedCount++;break;case"scheduled":case"confirmed":l.pending+=b,l.total+=b;break;case"canceled":l.canceled+=b,l.canceledCount++;break;case"no_show":l.noShowCount++}}return{stats:l,error:null}}async function f(a="month"){let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{data:[],error:"Nicht authentifiziert"};let{data:g}=await b.from("users").select("tenant_id").eq("id",e.id).single();if(!g?.tenant_id)return{data:[],error:"Kein Tenant gefunden"};let{start:h,end:i}=d(a),{data:j,error:k}=await b.from("appointments").select("start_time, price, status").eq("tenant_id",g.tenant_id).eq("status","completed").gte("start_time",h.toISOString()).lte("start_time",i.toISOString()).order("start_time",{ascending:!0});if(k)return{data:[],error:k.message};let l=new Map;for(let a of j||[]){let b=new Date(a.start_time).toISOString().split("T")[0],c=l.get(b)||{revenue:0,count:0};l.set(b,{revenue:c.revenue+(a.price||0),count:c.count+1})}let m=[],n=new Date(h);for(;n<=i;){let a=n.toISOString().split("T")[0],b=l.get(a)||{revenue:0,count:0};m.push({date:a,revenue:b.revenue,count:b.count}),n.setDate(n.getDate()+1)}return{data:m,error:null}}async function g(a="month"){let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{services:[],error:"Nicht authentifiziert"};let{data:f}=await b.from("users").select("tenant_id").eq("id",e.id).single();if(!f?.tenant_id)return{services:[],error:"Kein Tenant gefunden"};let{start:h,end:i}=d(a),{data:j,error:k}=await b.from("appointments").select(`
      service_id,
      price,
      status,
      services (
        id,
        name
      )
    `).eq("tenant_id",f.tenant_id).in("status",["completed","scheduled","confirmed"]).gte("start_time",h.toISOString()).lte("start_time",i.toISOString());if(k)return{services:[],error:k.message};let l=new Map;for(let a of j||[]){let b=Array.isArray(a.services)?a.services[0]:a.services;if(!b)continue;let c=b.id,d=b.name,e=l.get(c)||{id:c,name:d,bookingCount:0,revenue:0,averagePrice:0};e.bookingCount++,e.revenue+=a.price||0,l.set(c,e)}return{services:Array.from(l.values()).map(a=>({...a,averagePrice:a.bookingCount>0?a.revenue/a.bookingCount:0})).sort((a,b)=>b.bookingCount-a.bookingCount),error:null}}async function h(a="month"){let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{employees:[],error:"Nicht authentifiziert"};let{data:f}=await b.from("users").select("tenant_id").eq("id",e.id).single();if(!f?.tenant_id)return{employees:[],error:"Kein Tenant gefunden"};let{start:g,end:i}=d(a),{data:j,error:k}=await b.from("appointments").select(`
      employee_id,
      price,
      status,
      employees (
        id,
        first_name,
        last_name
      )
    `).eq("tenant_id",f.tenant_id).not("employee_id","is",null).gte("start_time",g.toISOString()).lte("start_time",i.toISOString());if(k)return{employees:[],error:k.message};let l=new Map;for(let a of j||[]){if(!a.employee_id)continue;let b=Array.isArray(a.employees)?a.employees[0]:a.employees;if(!b)continue;let c=l.get(a.employee_id)||{id:a.employee_id,name:`${b.first_name} ${b.last_name}`,appointmentCount:0,revenue:0,completedCount:0};c.appointmentCount++,"completed"===a.status&&(c.revenue+=a.price||0,c.completedCount++),l.set(a.employee_id,c)}return{employees:Array.from(l.values()).sort((a,b)=>b.revenue-a.revenue),error:null}}async function i(a="month"){let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{stats:null,error:"Nicht authentifiziert"};let{data:f}=await b.from("users").select("tenant_id").eq("id",e.id).single();if(!f?.tenant_id)return{stats:null,error:"Kein Tenant gefunden"};let{start:g,end:h}=d(a),{count:j}=await b.from("customers").select("*",{count:"exact",head:!0}).eq("tenant_id",f.tenant_id),{count:k}=await b.from("customers").select("*",{count:"exact",head:!0}).eq("tenant_id",f.tenant_id).gte("created_at",g.toISOString()).lte("created_at",h.toISOString()),{data:l}=await b.from("appointments").select("customer_id, price, status").eq("tenant_id",f.tenant_id).eq("status","completed").gte("start_time",g.toISOString()).lte("start_time",h.toISOString()),m=new Map,n=0;for(let a of l||[]){let b=m.get(a.customer_id)||0;m.set(a.customer_id,b+1),n+=a.price||0}return{stats:{totalCustomers:j||0,newCustomers:k||0,returningCustomers:Array.from(m.values()).filter(a=>a>1).length,averageSpent:m.size>0?n/m.size:0},error:null}}(0,a.i(98246).ensureServerEntryExports)([e,f,g,h,i]),(0,b.registerServerReference)(e,"4078fb8ea762750431f1c09776919659dc3d0b0635",null),(0,b.registerServerReference)(f,"4073d8e6e96ebb9b7cb63118941bb6d6d67ccbf3d3",null),(0,b.registerServerReference)(g,"40c4a7aa5ba46dad44656eb17c3e905f481f09d023",null),(0,b.registerServerReference)(h,"40ac9402f23b1bd4fc9d0ac190cfcdef0ca0da692f",null),(0,b.registerServerReference)(i,"405b2fa7f26c9244805fae2402ed480423dba0f5b1",null),a.s(["getCustomerStats",()=>i,"getDailyRevenue",()=>f,"getEmployeeStats",()=>h,"getRevenueStats",()=>e,"getServiceStats",()=>g])},18253,a=>{"use strict";var b=a.i(76392),c=a.i(61210);a.s([],9961),a.i(9961),a.s(["00ea5d6db9aa78d155ad7148c00d987a78197cad0e",()=>b.logout,"40557600bffd5a2c9eccc9fb8b66b41ea0de68fa87",()=>b.login,"405b2fa7f26c9244805fae2402ed480423dba0f5b1",()=>c.getCustomerStats,"4073d8e6e96ebb9b7cb63118941bb6d6d67ccbf3d3",()=>c.getDailyRevenue,"4078fb8ea762750431f1c09776919659dc3d0b0635",()=>c.getRevenueStats,"40ac9402f23b1bd4fc9d0ac190cfcdef0ca0da692f",()=>c.getEmployeeStats,"40c4a7aa5ba46dad44656eb17c3e905f481f09d023",()=>c.getServiceStats,"40edf544285d63aedbf98dd3fd472b99b616040b0a",()=>b.signup],18253)}];

//# sourceMappingURL=apps_web_5bca6581._.js.map