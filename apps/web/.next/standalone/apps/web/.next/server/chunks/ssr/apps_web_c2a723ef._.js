module.exports=[45424,a=>{"use strict";var b=a.i(38735),c=a.i(56511),d=a.i(80159),e=a.i(81182);async function f(){let a=await (0,d.createClient)(),{data:b,error:c}=await a.from("appointments").select(`
      *,
      customers (
        id,
        first_name,
        last_name,
        phone
      ),
      services (
        id,
        name,
        duration_minutes,
        price
      ),
      employees (
        id,
        first_name,
        last_name,
        role,
        specialties,
        is_active,
        work_schedule
      )
    `).order("start_time",{ascending:!0});return c?(console.error("Error fetching appointments:",c),{appointments:[],error:c.message}):{appointments:b,error:null}}async function g(a){let b=await (0,d.createClient)(),f=(0,e.createAdminClient)(),{data:{user:g}}=await b.auth.getUser();if(!g)return{error:"Nicht authentifiziert"};let{data:h}=await f.from("users").select("tenant_id").eq("id",g.id).single();if(!h)return{error:"Profil nicht gefunden"};let i=a.get("customer_id"),j=a.get("service_id"),k=a.get("employee_id"),l=a.get("appointment_date"),m=a.get("appointment_time"),n=a.get("customer_notes"),{data:o}=await b.from("services").select("duration_minutes, price").eq("id",j).single();if(!o)return{error:"Service nicht gefunden"};let p=new Date(`${l}T${m}`),q=new Date(p.getTime()+6e4*o.duration_minutes);if(k){let{data:a}=await b.from("appointments").select("id, start_time, end_time").eq("employee_id",k).neq("status","cancelled").or(`and(start_time.lt.${q.toISOString()},end_time.gt.${p.toISOString()})`);if(a&&a.length>0)return{error:"Der Mitarbeiter ist zu dieser Zeit bereits gebucht. Bitte wähle einen anderen Zeitpunkt oder Mitarbeiter."}}let r=function(){let a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",b="";for(let c=0;c<32;c++)b+=a.charAt(Math.floor(Math.random()*a.length));return b}(),{error:s}=await b.from("appointments").insert({tenant_id:h.tenant_id,customer_id:i,service_id:j,employee_id:k||null,start_time:p.toISOString(),end_time:q.toISOString(),price:o.price,status:"scheduled",customer_notes:n||null,confirmation_token:r});return s?(console.error("Error creating appointment:",s),{error:s.message}):((0,c.revalidatePath)("/dashboard/appointments"),{error:null})}async function h(a,b){let e=await (0,d.createClient)(),f=b.get("customer_id"),g=b.get("service_id"),h=b.get("employee_id"),i=b.get("appointment_date"),j=b.get("appointment_time"),k=b.get("status"),l=b.get("customer_notes"),{data:m}=await e.from("services").select("duration_minutes, price").eq("id",g).single();if(!m)return{error:"Service nicht gefunden"};let n=new Date(`${i}T${j}`),o=new Date(n.getTime()+6e4*m.duration_minutes);if(h){let{data:b}=await e.from("appointments").select("id, start_time, end_time").eq("employee_id",h).neq("id",a).neq("status","cancelled").or(`and(start_time.lt.${o.toISOString()},end_time.gt.${n.toISOString()})`);if(b&&b.length>0)return{error:"Der Mitarbeiter ist zu dieser Zeit bereits gebucht. Bitte wähle einen anderen Zeitpunkt oder Mitarbeiter."}}let{error:p}=await e.from("appointments").update({customer_id:f,service_id:g,employee_id:h||null,start_time:n.toISOString(),end_time:o.toISOString(),price:m.price,status:k,customer_notes:l||null}).eq("id",a);return p?(console.error("Error updating appointment:",p),{error:p.message}):((0,c.revalidatePath)("/dashboard/appointments"),{error:null})}async function i(a){let b=await (0,d.createClient)(),{error:e}=await b.from("appointments").delete().eq("id",a);return e?(console.error("Error deleting appointment:",e),{error:e.message}):((0,c.revalidatePath)("/dashboard/appointments"),{error:null})}async function j(a,b){let e=await (0,d.createClient)(),{data:f}=await e.from("appointments").select("tenant_id, service_id, employee_id, location_id, start_time").eq("id",a).single(),{error:g}=await e.from("appointments").update({status:b}).eq("id",a);if(g)return console.error("Error updating appointment status:",g),{error:g.message};let h=[];if("canceled"===b&&f){let{matches:a}=await k(f.tenant_id,f.service_id,new Date(f.start_time).toISOString().split("T")[0],new Date(f.start_time).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),f.employee_id,f.location_id);h=a}return(0,c.revalidatePath)("/dashboard/appointments"),(0,c.revalidatePath)("/dashboard/waitlist"),{error:null,waitlistMatches:h}}async function k(a,b,c,e,f,g){let h=(await (0,d.createClient)()).from("waitlist").select("id, customer_name, customer_phone, customer_email, employee_id, preferred_time_from, preferred_time_to").eq("tenant_id",a).eq("service_id",b).eq("status","waiting").lte("preferred_date_from",c).gte("preferred_date_to",c).order("priority",{ascending:!1}).order("created_at",{ascending:!0}).limit(5),{data:i,error:j}=await h;if(j||!i)return{matches:[]};let k=parseInt(e.replace(":",""));return{matches:i.filter(a=>{if(!a.preferred_time_from&&!a.preferred_time_to)return!0;let b=a.preferred_time_from?parseInt(a.preferred_time_from.replace(":","")):0,c=a.preferred_time_to?parseInt(a.preferred_time_to.replace(":","")):2359;return k>=b&&k<=c}).filter(a=>!a.employee_id||a.employee_id===f).map(a=>({id:a.id,customer_name:a.customer_name,customer_phone:a.customer_phone,customer_email:a.customer_email}))}}(0,a.i(98246).ensureServerEntryExports)([f,g,h,i,j]),(0,b.registerServerReference)(f,"006e777ff37b38d056829d5a12bb03c5a80ff7aa5b",null),(0,b.registerServerReference)(g,"4026c9fd8c6a0c2a149b046d98dce7640094e3e759",null),(0,b.registerServerReference)(h,"60a4f4ade2852b49b8a0f9a20d20162d506a525fba",null),(0,b.registerServerReference)(i,"4040a59ddfda05d6095b129d2d9e5edf54d6caeb0c",null),(0,b.registerServerReference)(j,"6058c3eb3c1d0a7452f1f43331c272ffec3d595ddb",null),a.s(["createAppointment",()=>g,"deleteAppointment",()=>i,"getAppointments",()=>f,"updateAppointment",()=>h,"updateAppointmentStatus",()=>j])},68405,a=>{"use strict";var b=a.i(76392),c=a.i(45424),d=a.i(81032),e=a.i(71118),f=a.i(93452);a.s([],90976),a.i(90976),a.s(["0012f034365b466b68faf986a4afe957bff0eb83a1",()=>d.getCustomers,"0042a2abe349a413d4622436da0130103736329c4f",()=>e.exportServices,"005d4a16cc3f1c9d6de42a96aa62f2bab538afa94b",()=>e.getServices,"006e777ff37b38d056829d5a12bb03c5a80ff7aa5b",()=>c.getAppointments,"0093e37328b590a65f8d37e8ce9fa05c903d1afef9",()=>f.getEmployees,"00bca40b9c27440715c941e69fbf2f341e7b2dda70",()=>f.getActiveEmployees,"00ea5d6db9aa78d155ad7148c00d987a78197cad0e",()=>b.logout,"400d346cab7161c17ec93d5519b52beca6ecac9269",()=>d.createCustomer,"4026c9fd8c6a0c2a149b046d98dce7640094e3e759",()=>c.createAppointment,"402cd21ffb7a3c56b09af06fb4c5043b38c5a55190",()=>e.createService,"402d4e400989e2c0d06ef868649fd9b933ed170464",()=>d.getCustomerAppointments,"4031f14c1707f0e37da0005df8fa8ab36c1a3f5935",()=>e.uploadServiceImage,"403436518ac5fdd91354ed91d48edcf3a3c5db3175",()=>f.createEmployee,"4034854ccfb5932e3e079d755981213270ff1a89c6",()=>f.uploadEmployeeImage,"4040a59ddfda05d6095b129d2d9e5edf54d6caeb0c",()=>c.deleteAppointment,"40557600bffd5a2c9eccc9fb8b66b41ea0de68fa87",()=>b.login,"4072eae6cf452ff8a263c5ef9e89fb633185d5b94d",()=>e.deleteService,"4099f22a0b2ee55dee09b996db562a5dc53e70d768",()=>d.getCustomerById,"40a31f38d9ffa3be3e030d3686f3cc427ead83e6d7",()=>e.importServices,"40bbaf84ed7728bb863828c5d4c38a963fa07777c9",()=>d.getCustomerStats,"40c664ac32d3e5bdf26b6e9a0eb615d306433dcb5f",()=>f.deleteEmployee,"40c79fe125d7170d0b436107d1bde5b3b4e18b25be",()=>d.deleteCustomer,"40edf544285d63aedbf98dd3fd472b99b616040b0a",()=>b.signup,"40fb98609ed453fa86f0d09f3d89f9effabb985abc",()=>f.deleteEmployeeImage,"60000f278c7756b8a4b5c23d534c1552ce41a65fb2",()=>d.updateAppointmentNotes,"6020af006a3b69df729950905fd13bb582e96bc819",()=>f.updateEmployee,"6058c3eb3c1d0a7452f1f43331c272ffec3d595ddb",()=>c.updateAppointmentStatus,"608de8ff0a4bdc697186ecb3f9f725e339083da387",()=>e.updateService,"60a4f4ade2852b49b8a0f9a20d20162d506a525fba",()=>c.updateAppointment,"60cdf908f1b0690e1642847a4cb020fde78f95ad2f",()=>d.updateCustomer,"60e0e2c66009f6838a672eccb9b91822df45af2e93",()=>e.toggleServiceStatus,"701e6f343c3a139d8a96c97361c4a30c15bc2d25b9",()=>d.updateCustomerNotes,"70fbf593b00f45ddaaf89fb3bd6e42222afbc2a28e",()=>f.getEmployeeStats],68405)}];

//# sourceMappingURL=apps_web_c2a723ef._.js.map