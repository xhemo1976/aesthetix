module.exports=[38735,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(80846)},98246,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},81182,a=>{"use strict";var b=a.i(46557);function c(){return(0,b.createClient)("https://hccoltgswaqhpyzswvwa.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}a.s(["createAdminClient",()=>c])},66680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},66076,a=>{"use strict";var b=a.i(38735),c=a.i(80159),d=a.i(81182),e=a.i(56511);async function f(){let a=await (0,c.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return{locations:[],error:"Nicht authentifiziert"};let{data:d}=await a.from("users").select("tenant_id").eq("id",b.id).single();if(!d?.tenant_id)return{locations:[],error:"Kein Tenant gefunden"};let{data:e,error:f}=await a.from("locations").select("*").eq("tenant_id",d.tenant_id).order("is_primary",{ascending:!1}).order("name",{ascending:!0});if(f)return{locations:[],error:f.message};let g=[];for(let b of e||[]){let{count:c}=await a.from("employee_locations").select("*",{count:"exact",head:!0}).eq("location_id",b.id),{count:d}=await a.from("services").select("*",{count:"exact",head:!0}).eq("location_id",b.id).eq("is_active",!0);g.push({...b,employee_count:c||0,service_count:d||0})}return{locations:g,error:null}}async function g(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("locations").select("*").eq("id",a).single();return e?{location:null,error:e.message}:{location:d,error:null}}async function h(a){let b=await (0,c.createClient)(),{data:{user:d}}=await b.auth.getUser();if(!d)return{location:null,error:"Nicht authentifiziert"};let{data:f}=await b.from("users").select("tenant_id, role").eq("id",d.id).single();if(!f?.tenant_id)return{location:null,error:"Kein Tenant gefunden"};if(!["owner","admin"].includes(f.role))return{location:null,error:"Keine Berechtigung"};let g=a.get("name"),h=a.get("slug"),i=a.get("address"),j=a.get("city"),k=a.get("postal_code"),l=a.get("phone"),m=a.get("email"),n=a.get("whatsapp_number");if(!g||!h)return{location:null,error:"Name und Slug sind erforderlich"};let{data:o}=await b.from("locations").select("id").eq("tenant_id",f.tenant_id).eq("slug",h).single();if(o)return{location:null,error:"Dieser Slug wird bereits verwendet"};let p={tenant_id:f.tenant_id,name:g,slug:h.toLowerCase().replace(/[^a-z0-9-]/g,"-"),address:i||null,city:j||null,postal_code:k||null,phone:l||null,email:m||null,whatsapp_number:n||null,is_active:!0,is_primary:!1},{data:q,error:r}=await b.from("locations").insert(p).select().single();return r?{location:null,error:r.message}:((0,e.revalidatePath)("/dashboard/locations"),{location:q,error:null})}async function i(a,b){let d=await (0,c.createClient)(),f=b.get("name"),g=b.get("address"),h=b.get("city"),i=b.get("postal_code"),j=b.get("phone"),k=b.get("email"),l=b.get("whatsapp_number"),m="true"===b.get("is_active"),{data:n,error:o}=await d.from("locations").update({name:f,address:g||null,city:h||null,postal_code:i||null,phone:j||null,email:k||null,whatsapp_number:l||null,is_active:m}).eq("id",a).select().single();return o?{location:null,error:o.message}:((0,e.revalidatePath)("/dashboard/locations"),{location:n,error:null})}async function j(a){let b=await (0,c.createClient)(),{data:d}=await b.from("locations").select("is_primary").eq("id",a).single();if(d?.is_primary)return{success:!1,error:"Der Hauptstandort kann nicht gelÃ¶scht werden"};let{error:f}=await b.from("locations").delete().eq("id",a);return f?{success:!1,error:f.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function k(a){let b=await (0,c.createClient)(),{data:{user:d}}=await b.auth.getUser();if(!d)return{success:!1,error:"Nicht authentifiziert"};let{data:f}=await b.from("users").select("tenant_id").eq("id",d.id).single();if(!f?.tenant_id)return{success:!1,error:"Kein Tenant gefunden"};await b.from("locations").update({is_primary:!1}).eq("tenant_id",f.tenant_id);let{error:g}=await b.from("locations").update({is_primary:!0}).eq("id",a);return g?{success:!1,error:g.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function l(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("employee_locations").select(`
      employees (
        id,
        first_name,
        last_name,
        role
      )
    `).eq("location_id",a);return e?{employees:[],error:e.message}:{employees:(d||[]).map(a=>Array.isArray(a.employees)?a.employees[0]:a.employees).filter(Boolean),error:null}}async function m(a,b){let d=await (0,c.createClient)(),{error:f}=await d.from("employee_locations").insert({employee_id:a,location_id:b});return f?"23505"===f.code?{success:!1,error:"Mitarbeiter ist bereits diesem Standort zugewiesen"}:{success:!1,error:f.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function n(a,b){let d=await (0,c.createClient)(),{error:f}=await d.from("employee_locations").delete().eq("employee_id",a).eq("location_id",b);return f?{success:!1,error:f.message}:((0,e.revalidatePath)("/dashboard/locations"),{success:!0,error:null})}async function o(a){let b=(0,d.createAdminClient)(),{data:c}=await b.from("tenants").select("id").eq("slug",a).single();if(!c)return{locations:[],error:"Tenant nicht gefunden"};let{data:e,error:f}=await b.from("locations").select("*").eq("tenant_id",c.id).eq("is_active",!0).order("is_primary",{ascending:!1}).order("name",{ascending:!0});return f?{locations:[],error:f.message}:{locations:e||[],error:null}}async function p(a,b){let c=(0,d.createAdminClient)(),{data:e}=await c.from("tenants").select("id").eq("slug",a).single();if(!e)return{location:null,error:"Tenant nicht gefunden"};let{data:f,error:g}=await c.from("locations").select("*").eq("tenant_id",e.id).eq("slug",b).eq("is_active",!0).single();return g?{location:null,error:g.message}:{location:f,error:null}}(0,a.i(98246).ensureServerEntryExports)([f,g,h,i,j,k,l,m,n,o,p]),(0,b.registerServerReference)(f,"0055b89c801663552805ddc909292e775db7be216e",null),(0,b.registerServerReference)(g,"4037ff8b431861586ad97cd1e90717ce84f298b15d",null),(0,b.registerServerReference)(h,"40f54ec9e5477630fdb316dff0ae467e31697718f6",null),(0,b.registerServerReference)(i,"604a24bf2e6a49d259d29523655d0f76667aa253b3",null),(0,b.registerServerReference)(j,"40b78c56213e2c793df5b07094b681c8a692b2184b",null),(0,b.registerServerReference)(k,"40a0a4208153142c8e89a3bfcc14e6935d23ca1e9e",null),(0,b.registerServerReference)(l,"40b1e54b6f607f754e725a9dd43ea09889f3684f34",null),(0,b.registerServerReference)(m,"60297aeec1b44af1ea5303b7ea622c2305a16198cc",null),(0,b.registerServerReference)(n,"6021891db63625de842e1acd9ce600c58b0dcf65af",null),(0,b.registerServerReference)(o,"4095af700589660c59d792e54e467cf5e6cb9ca856",null),(0,b.registerServerReference)(p,"60a9690d48ecf36d6cc007c00e1aa0f1880037f3a1",null),a.s(["assignEmployeeToLocation",()=>m,"createLocation",()=>h,"deleteLocation",()=>j,"getLocationById",()=>g,"getLocationEmployees",()=>l,"getLocations",()=>f,"getPublicLocationBySlug",()=>p,"getPublicLocations",()=>o,"removeEmployeeFromLocation",()=>n,"setLocationAsPrimary",()=>k,"updateLocation",()=>i])},99159,a=>{"use strict";function b(a,b){let c=a.replace(/[\s\-\(\)]/g,""),d=encodeURIComponent(b);return`https://wa.me/${c}?text=${d}`}function c(a){let b=`Hallo ${a.customerName}! ðŸ‘‹

Termin-Best\xe4tigung bei ${a.clinicName}:

ðŸ“… Datum: ${a.date}
ðŸ• Uhrzeit: ${a.time}
ðŸ’† Behandlung: ${a.serviceName}`;return a.confirmationUrl?`${b}

ðŸ”— Bitte best\xe4tigen Sie Ihren Termin:
${a.confirmationUrl}

Wir freuen uns auf Sie!`:`${b}

Bis bald!`}function d(a){return`Hallo ${a.customerName}! ðŸ‘‹

Gute Nachrichten von ${a.clinicName}! ðŸŽ‰

Ein Termin ist frei geworden f\xfcr Ihre gew\xfcnschte Behandlung:

ðŸ’† ${a.serviceName}
ðŸ“… ${a.date}
ðŸ• ${a.time}

Buchen Sie jetzt, bevor der Termin vergeben ist:
ðŸ”— ${a.bookingUrl}

Bei Fragen melden Sie sich gerne!`}a.s(["generateWhatsAppLink",()=>b,"getAppointmentConfirmationMessage",()=>c,"getWaitlistNotificationMessage",()=>d])},28713,a=>{"use strict";var b=a.i(38735),c=a.i(56511),d=a.i(80159),e=a.i(81182),f=a.i(99159);async function g(a){let b=(await (0,d.createClient)()).from("waitlist").select(`
      *,
      services (name, duration_minutes),
      employees (first_name, last_name),
      locations (name)
    `).order("priority",{ascending:!1}).order("created_at",{ascending:!0});a&&(b=b.eq("status",a));let{data:c,error:e}=await b;return e?(console.error("Error fetching waitlist:",e),{entries:[],error:e.message}):{entries:c||[],error:null}}async function h(a,b,c,e){let f=(await (0,d.createClient)()).from("waitlist").select(`
      *,
      services (name, duration_minutes),
      employees (first_name, last_name)
    `).eq("service_id",a).eq("status","waiting").lte("preferred_date_from",b).gte("preferred_date_to",b).order("priority",{ascending:!1}).order("created_at",{ascending:!0});c&&(f=f.or(`employee_id.eq.${c},employee_id.is.null`)),e&&(f=f.or(`location_id.eq.${e},location_id.is.null`));let{data:g,error:h}=await f;return h?(console.error("Error fetching waitlist for service:",h),{entries:[],error:h.message}):{entries:g||[],error:null}}async function i(a){let b=await (0,d.createClient)(),f=(0,e.createAdminClient)(),{data:{user:g}}=await b.auth.getUser();if(!g)return{error:"Nicht authentifiziert"};let{data:h}=await f.from("users").select("tenant_id").eq("id",g.id).single();if(!h)return{error:"Profil nicht gefunden"};let i=a.get("service_id"),j=a.get("employee_id"),k=a.get("location_id"),l=a.get("customer_id"),m=a.get("customer_name"),n=a.get("customer_email"),o=a.get("customer_phone"),p=a.get("preferred_date_from"),q=a.get("preferred_date_to"),r=a.get("preferred_time_from"),s=a.get("preferred_time_to"),t=a.get("notes"),u=parseInt(a.get("priority"))||0;if(!i||!m||!p||!q)return{error:"Bitte fÃ¼lle alle Pflichtfelder aus"};if(!n&&!o)return{error:"E-Mail oder Telefonnummer erforderlich"};let{error:v}=await b.from("waitlist").insert({tenant_id:h.tenant_id,service_id:i,employee_id:j||null,location_id:k||null,customer_id:l||null,customer_name:m,customer_email:n||null,customer_phone:o||null,preferred_date_from:p,preferred_date_to:q,preferred_time_from:r||null,preferred_time_to:s||null,notes:t||null,priority:u,status:"waiting"});return v?(console.error("Error adding to waitlist:",v),{error:v.message}):((0,c.revalidatePath)("/dashboard/waitlist"),{error:null})}async function j(a){let b=(0,e.createAdminClient)(),c=a.get("tenant_slug"),d=a.get("service_id"),f=a.get("employee_id"),g=a.get("location_id"),h=a.get("customer_name"),i=a.get("customer_email"),j=a.get("customer_phone"),k=a.get("preferred_date_from"),l=a.get("preferred_date_to"),m=a.get("preferred_time_from"),n=a.get("preferred_time_to"),o=a.get("notes");if(!c||!d||!h||!k||!l)return{error:"Bitte fÃ¼lle alle Pflichtfelder aus"};if(!i&&!j)return{error:"E-Mail oder Telefonnummer erforderlich"};let{data:p}=await b.from("tenants").select("id").eq("slug",c).single();if(!p)return{error:"Klinik nicht gefunden"};let q=null;if(i){let{data:a}=await b.from("customers").select("id").eq("tenant_id",p.id).eq("email",i).single();q=a?.id||null}let{error:r}=await b.from("waitlist").insert({tenant_id:p.id,service_id:d,employee_id:f||null,location_id:g||null,customer_id:q,customer_name:h,customer_email:i||null,customer_phone:j||null,preferred_date_from:k,preferred_date_to:l,preferred_time_from:m||null,preferred_time_to:n||null,notes:o||null,priority:0,status:"waiting"});return r?(console.error("Error adding to public waitlist:",r),{error:r.message}):{error:null,success:!0}}async function k(a,b){let e=await (0,d.createClient)(),f={status:b};if("notified"===b){f.notified_at=new Date().toISOString();let{data:b}=await e.from("waitlist").select("notification_count").eq("id",a).single();f.notification_count=(b?.notification_count||0)+1}let{error:g}=await e.from("waitlist").update(f).eq("id",a);return g?(console.error("Error updating waitlist status:",g),{error:g.message}):((0,c.revalidatePath)("/dashboard/waitlist"),{error:null})}async function l(a){let b=await (0,d.createClient)(),{error:e}=await b.from("waitlist").delete().eq("id",a);return e?(console.error("Error deleting waitlist entry:",e),{error:e.message}):((0,c.revalidatePath)("/dashboard/waitlist"),{error:null})}async function m(a,b,c,e){let g=await (0,d.createClient)(),{data:h}=await g.from("waitlist").select(`
      *,
      services (name)
    `).eq("id",a).single();if(!h||!h.customer_phone)return{link:null,error:"Kein Telefon hinterlegt"};let i=Array.isArray(h.services)?h.services[0]:h.services,j=(0,f.getWaitlistNotificationMessage)({customerName:h.customer_name,serviceName:i?.name||"Ihr gewÃ¼nschter Service",date:b.date,time:b.time,clinicName:c,bookingUrl:e}),l=h.customer_phone.replace(/\s/g,"");l.startsWith("0")&&(l="49"+l.substring(1)),l.startsWith("+")||(l="+"+l);let m=`https://wa.me/${l.replace("+","")}?text=${encodeURIComponent(j)}`;return await k(a,"notified"),{link:m,error:null}}async function n(a,b,c,d,f,g){let h=(0,e.createAdminClient)().from("waitlist").select(`
      *,
      services (name, duration_minutes),
      employees (first_name, last_name)
    `).eq("tenant_id",a).eq("service_id",b).eq("status","waiting").lte("preferred_date_from",c).gte("preferred_date_to",c).order("priority",{ascending:!1}).order("created_at",{ascending:!0}).limit(5),{data:i,error:j}=await h;if(j)return console.error("Error finding waitlist matches:",j),{matches:[],error:j.message};let k=parseInt(d.replace(":",""));return{matches:(i||[]).filter(a=>{if(!a.preferred_time_from&&!a.preferred_time_to)return!0;let b=a.preferred_time_from?parseInt(a.preferred_time_from.replace(":","")):0,c=a.preferred_time_to?parseInt(a.preferred_time_to.replace(":","")):2359;return k>=b&&k<=c}).filter(a=>!a.employee_id||a.employee_id===f),error:null}}async function o(){let a=await (0,d.createClient)(),{count:b,error:c}=await a.from("waitlist").select("*",{count:"exact",head:!0}).eq("status","waiting");return c?(console.error("Error getting waitlist count:",c),{count:0,error:c.message}):{count:b||0,error:null}}(0,a.i(98246).ensureServerEntryExports)([g,h,i,j,k,l,m,n,o]),(0,b.registerServerReference)(g,"40f47cca60b822c173ca3a9376d99c0f2febad6cf3",null),(0,b.registerServerReference)(h,"78537af8d77deb5511bb1607b32f482e3f85326f7a",null),(0,b.registerServerReference)(i,"40459a667babdea845a7b9c41877fa4d7bb220e7cc",null),(0,b.registerServerReference)(j,"4096478aff657f5e749248d481ab5e7910203f8bcf",null),(0,b.registerServerReference)(k,"605b34cbe125981b9dc140e20e7debf77f5cd0f0a1",null),(0,b.registerServerReference)(l,"40785ea3e95e0c80b7932a6bb3c9395bdbb4e5da10",null),(0,b.registerServerReference)(m,"78c14a82da1c94ebb00627c84372bc25ec8b0f1a0d",null),(0,b.registerServerReference)(n,"7ef1eb754f580e1c4b0ad8650dfa537df6aab2ef70",null),(0,b.registerServerReference)(o,"00847b3161eaf3ed7ad9de464cc6f55943d410553c",null),a.s(["addToPublicWaitlist",()=>j,"addToWaitlist",()=>i,"deleteWaitlistEntry",()=>l,"findWaitlistMatchesForCancellation",()=>n,"getWaitlist",()=>g,"getWaitlistCount",()=>o,"getWaitlistForService",()=>h,"getWaitlistNotificationLink",()=>m,"updateWaitlistStatus",()=>k])},97604,a=>{"use strict";var b=a.i(10784),c=a.i(66076),d=a.i(28713);a.s([],62874),a.i(62874),a.s(["0055b89c801663552805ddc909292e775db7be216e",()=>c.getLocations,"401ab6a9aae66ad3c663d37177a28761a50de910ee",()=>b.createGastroReservation,"4034ab78515d89dd8370e54fcbad8cf8c83366bd17",()=>b.createPublicBooking,"4037ff8b431861586ad97cd1e90717ce84f298b15d",()=>c.getLocationById,"40394eb15837163bc3d0e2b8728bd98534c8eb1a92",()=>b.lookupCustomer,"406fa60bec12d89d8022080631ba11caba95d87739",()=>b.getAvailableSlots,"408746f77faeab5a99a1f8e5efe30512a431619bb2",()=>b.getGastroSlots,"4095af700589660c59d792e54e467cf5e6cb9ca856",()=>c.getPublicLocations,"4096478aff657f5e749248d481ab5e7910203f8bcf",()=>d.addToPublicWaitlist,"40a0a4208153142c8e89a3bfcc14e6935d23ca1e9e",()=>c.setLocationAsPrimary,"40b1e54b6f607f754e725a9dd43ea09889f3684f34",()=>c.getLocationEmployees,"40b78c56213e2c793df5b07094b681c8a692b2184b",()=>c.deleteLocation,"40cb9a708d3e4de295f8cce3fdfbb3adf4f7f990d3",()=>b.getTenantBySlug,"40e8cd9a91bd09a237ae6a742ffd34201e9a36201a",()=>b.getPublicAppointmentByToken,"40f54ec9e5477630fdb316dff0ae467e31697718f6",()=>c.createLocation,"6021891db63625de842e1acd9ce600c58b0dcf65af",()=>c.removeEmployeeFromLocation,"60297aeec1b44af1ea5303b7ea622c2305a16198cc",()=>c.assignEmployeeToLocation,"6037ddd6337bd0695f22bb3556eedb4946032da7c2",()=>b.getPublicServices,"604a24bf2e6a49d259d29523655d0f76667aa253b3",()=>c.updateLocation,"606f85d5a150cd3119cc7e0b76586d2ebc987ea17f",()=>b.getPublicEmployees,"60a9690d48ecf36d6cc007c00e1aa0f1880037f3a1",()=>c.getPublicLocationBySlug],97604)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__97936d9d._.js.map